# HuanweiDZ 对账工具开发日记

## 2020-10-26

目前 WPF 版的基础架构已经做出来一个原型了。

目前问题纠结在于，为了适应 .Net Framework 3.5 的兼容性，使用了 .net core 作为框架，是可以在 Windows 7 中安装运行的。但是出于对用户电脑性能的顾虑，并没有使用 Microsoft.Office.Interop.Excel 的最新版本，而是找到了一个网上流行的开源项目 ExcelDataReader。这样的好处是可以读取 Excel 文件，问题是不能生成 Excel 文件。

那么，既然整个工作流程是 Excel → 数据处理 → Excel，那么这个 WPF 的界面摆在那里就显得非常突兀，好像绕了一个超级大圈子。Excel 转入需要转换，处理完了之后，再用 Excel 进行导出，非但 Interop 库无法完美避开，连系统兼容性都无法保证。

现在合理的设计流程，就是针对 Excel 2007 版本，设计一个 加载项程序。

这个程序会以 Ribbon 的形式出现在 Excel 2007 工具栏上方。点击后展开 TaskPanel，其中含有了当前的视图信息，已经同步的账目条目信息（比如银行或者公司侧共几条，总额多少），在点击 生成 按钮之后开始创建新的工作簿，填充相关对账信息。



### 如何在 Visual Studio 2019 版本中开发针对 Excel 2007 的插件？

目前找到的官方文档是没有的。VS 2008 / 2010 中原生态支持 Excel 2007 的插件开发，但是这两个版本微软官方已经 OoS 了。只看得到技术文档，无法下载软件。

找到了一个号称可以进行 Excel 2007 插件开发的 叫做 Add-In Express。

https://www.add-in-express.com/docs/net.php

然后这玩意竟然要钱，349USD。

现就不说这东西到底好不好用，买了之后学就要学很久。而且算上版本迭代。我觉得不值得。注意，微软对于现有支持的版本是提供开发插件的支持的，免费。也就是说虽然几率不大但是一旦客户开始使用现有支持的 Office 版本我买这个软件就会很挫。

竟然是订购不是买断。。你在逗我吗。

在 stackoverflow 问题上面打广告的行为也挺弟弟的。

但是一番调查下来，这件事情可能吗？可能。麻烦吗？非常麻烦。要不然也不会有人专门去开发一套适配古旧版本的VS2019扩展件了（还卖得死贵）。

这个方案可以作为一个备选项目。

### 确认结果：

依然是加载项比较适合这个项目。





